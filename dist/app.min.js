(function(){"use strict";var e=32,t=16,n=0,r=8,i=4,s=2,o=1,u=function(){var t=[],n=document.getElementById("gameboard");this.appendRow=function(r){t=t.concat(r),n.appendChild(r.getDomEl())},this.getTile=function(n,r){return r>-1&&r<t.length?t[r].getTile(n):undefined},this.getAllTiles=function(){return t.reduce(function(e,t){return e.concat(t.getAllTiles())},[])},this.clearDomEl=function(){n.innerHTML=""}},a=function(){var t=[],n;this.appendTile=function(r){t=t.concat(r),n.appendChild(r.getDomEl())},this.getTile=function(n){return n>-1&&n<t.length?t[n]:undefined},this.getAllTiles=function(){return t},this.getDomEl=function(){return n},n=document.createElement("div"),n.classList.add("row")},f=function(a,f,l){var c,p=n,d=!1,v=l&15,m=!0,g,y=a,b=f,w=this,x=function(t){if(w==t)return!0;var n=t.getX()-w.getX(),u=t.getY()-w.getY();if(Math.abs(n)+Math.abs(u)==1){if(n>0)return w.hasLinkTo(i)&&t.hasLinkTo(o);if(n<0)return w.hasLinkTo(o)&&t.hasLinkTo(i);if(u>0)return w.hasLinkTo(s)&&t.hasLinkTo(r);if(u<0)return w.hasLinkTo(r)&&t.hasLinkTo(s)}return!1},T=function(){return[r,s,o,i].reduce(function(e,t){var n=C(t);return n&&x(n)?e.concat(n):e},[])},C=function(t){switch(t){case r:return h.getTile(y,b-1);case s:return h.getTile(y,b+1);case o:return h.getTile(y-1,b);case i:return h.getTile(y+1,b)}},k=function(){var t=(v&8)==8;v<<=1,v&=15,t&&(v|=1),m=!0},L=function(){var t=(v&1)==1;v>>=1,t&&(v|=8),m=!0};this.setPower=function(t){m==0&&d!=t&&(m=!0),d=t},this.hasLinkTo=function(t){return(v&t)==t},this.isPoweredOn=function(){return d},this.getLayout=function(){return c},this.getX=function(){return y},this.getY=function(){return b},this.getRotation=function(){switch(v){case r:case r|s:case r|i:case r|s|i:return 0;case i:case o|i:case s|i:case s|o|i:return 90;case s:case s|o:case r|s|o:return 180;case o:case r|o:case r|o|i:return 270}},this.getType=function(){return p},this.getDomEl=function(){return g},this.lightUp=function(t){t=t||[],t=t.concat(this),this.setPower(!0),T().forEach(function(e){t.indexOf(e)<0&&e.lightUp(t)})},this.updateDom=function(){m&&(g.setAttribute("data-rotation",this.getRotation()),g.setAttribute("data-power",this.isPoweredOn()?"1":"0"),m=!1)};if(v==0)throw new TypeError("Corrupt data. Cell "+a+"|"+f+" has no lines");if(v==15)throw new TypeError("Corrupt data. Cell "+a+"|"+f+" is a cross");switch(v){case r:case i:case s:case o:c="O";break;case r|i:case s|i:case s|o:case r|o:c="L";break;case r|s:case o|i:c="I";break;case r|s|o:case r|s|i:case r|o|i:case s|o|i:c="T"}if((l&t)==t){if((l&e)==e)throw new TypeError("Corrupt data. Cell "+a+"|"+f+" has set both house and factory");p=t}else(l&e)==e&&(p=e);g=document.createElement("div"),g.appendChild(document.createElement("div")),g.appendChild(document.createElement("div")),g.classList.add("tile"),g.setAttribute("data-layout",c),p==t?g.classList.add("house"):p==e&&g.classList.add("factory"),g.oncontextmenu=function(e){e.stopPropagation(),e.preventDefault()},g.onmouseup=function(e){e.which==3?(k(),h.makeMove()):e.which==1&&(L(),h.makeMove())},g.ontouchend=function(e){e.preventDefault(),L(),h.makeMove()},g.ontouchmove=function(e){return e.preventDefault(),!1}},l=function(){var n=new u,r,i=-1,s=document.getElementById("move-count"),o=function(){n.getAllTiles().forEach(function(e){e.setPower(0)}),r.lightUp(),n.getAllTiles().forEach(function(e){e.updateDom()})},l=function(){document.querySelector('.tile[data-power="0"]')==null&&alert("Solved!")},c=function(){i++,s.textContent=i+" moves"};this.makeMove=function(){c(),o(),l()},this.getTile=function(t,r){return n.getTile(t,r)},this.load=function(i){var s=i[0],o=i[1],u=2;if(i.length-2!=s*o)throw new TypeError("Corrupt data. Grid size specification does not match data size");for(var l=0;l<o;l++){var c=new a;for(var h=0;h<s;h++,u++)c.appendTile(new f(h,l,i[u]));n.appendRow(c)}n.getAllTiles().forEach(function(t){t.updateDom(),t.getType()==e&&(r=t)}),this.makeMove()},this.clear=function(){n.clearDomEl(),n=new u}},c=[5,5,20,12,10,20,20,10,5,12,18,10,11,6,5,9,7,13,18,10,5,10,9,42,11,6,18],h=new l;h.load(c)})();